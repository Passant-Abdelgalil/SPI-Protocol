# SPI-Protocol
### Overview:
SPI is a synchronus serial communication protocol used for short-distance communication, it is mainly used in embedded systems.

The Module consists of two main devices which are: **the master** and **the slave** .

It is a full–duplex interface which means it can send and receive data at the same time.

The SPI can have multiple slaves, here it has 3 slaves.

The SPI Module implemented here has a 4x1 mux to choose between the three MISO lines according to the address of the communicating slave,
        and another one to choose between the three slave_out lines according to the address of the communicating slave .

### Important notations:
- SCLK: is the clk generated by the master to synchronize the transmission with the slave.
- CPOL: stands for Clock Polorization, it tells what the idle state of the SCLK is, 0 or 1
- CPHA: stands for Clock Phase, it tells the phase the data will be transmitted and the phase the data will be recieved.
- MISO: stands for "Master In Slave Out", it's a single wire line where the Master recieves the data from the Slave.
- MOSI: stands for "Master Out Slave In", it's a single wire line where the Slave recieves the data from the Master.
- CS: stands for Chip Select, a wire that controls whether the slave will communicate or not, 0 for activation, 1 for deactivation. 


### Steps of Transmission:
- The master generates the SCLK according to the CPOL.
- The master decodes the sent slave address to identify which slave to communicate with then pulls down the CS of the appropriate slave.
- According to the CPOL and CPHA values, the master reads the data from the slave on a specific edge (rising edge or falling edge) and writes data on the other edge.
- The master sends the serial data, one bit at each clock cycle along the MOSI line.
- If the SPI is working in full duplex, then the master reads the data from the slave along the MISO line.

### Top Module Inputs:  
-	**Load**: as explained before, to load data in master.
-	**Start**: as explained before, to start the communication.
-	**Resets**: 3 inputs resets each for one of the three slaves, to load the data in the communicating slave.
-	**Slave_Address**: to tell which slave will communicate with the mater
-	**Data_in_master**: external input data to the master.
-	**Data_in_slave**: external input data to the slave.

### Top Module Outputs:
-	**Data_out_master**: the output data of the master, in another meaning the received data from the slave.
-	**Data_out_slave**: the output data of the communicating slave, and it’s the output of a MUX according to the slave address.

### Internals:
-	**MISO**: by this line the data is sent from the slave into the master.
-	**MOSI**: by this line the data is sent from the master into the slave.
-	**CSs**: 3 CSs lines each for one of the three slaves.
-	**SCLK**: as explained before, to synchronize the transmission.
-	**Slave_start**: as explained before, to inform the right slave to start the communication.
-	**Data_out_slave1**: output data of the first slave.
-	**Data_out_slave2**: output data of the second slave.
-	**Data_out_slave3**: output data of the third slave.



### Master Inputs:
1.	**Clk**: from which the master generates the SCLK.
2.	**Start**: It is an input to start the communication.
3.	**Load**: to load the data_in if it’s required to transfer different data from the stored one in the master.
4.	**Data_to_write**: the input data to be loaded.
5.	**Slave_Address**: to determine which slave will communicate with the master.
6.	**CPOL, CPHA**: The four combinations of them determine the different modes of the operation of SPI.
                    These modes determine at which edge the data is received and transmitted and what is the idle state of the SCLK.
7.	**MISO**: from the slave.


### Master Outputs:
1.	**SCLK**: the clock that synchronizes the transmission of the data.
2.	**CSs**: one (CS) chip select for each slave so the slave can understand whether it will communicate or not.
3.	**MOSI**: To the slave.
4.	**Data_read**: to show the received data from the slave and output it to use it with the rest of the external circuit.
5.	**Slave_start**: to make the slave start communication at the right edge.

### Master Internals:
1.	**Transmission_buffer**: to store the Master data.
2.	**Sclk_old**: So, the master can compare it with the SCLK to know when it’s a +ve sclk or a -ve sclk.
3.	**cpol, cpha**: to store the input CPOL and CPHA at the beginning of the communication so the SPI works with only one mode during the communication.
4.	**Communication_flag**: to prevent the master from starting another communication parallel with a recent one.
         So, if the (start) input is 1 the master checks if communication_flag is 0 then the master will start the communication and set the flag to 0.
5.	**Count**: to count number of generated edges of SCLK, since 17 edges (including the idle state) are required to translate 8 bits.
6.	**Transmission_iterator**: to iterate on the bits of the stored data.
7.	**Countr**: since the iterator shouldn’t be advanced unless the recent bit has been sent and changed to the received one,
                when the countr = 2 this means (sending and receiving) have been done on this bit.
8.	**Sampled**: since there is a skipped edge in two modes, this internal reg helps to determine the right edge to communicate.


### Slave Inputs:
1.	**Reset**: It resets the internal memory of the slave to initial bits (active – high).
2.	**Data In**: It is the data which initializes the slave’s memory.
3.	**SCLK**: the master’s generated clock for data synchronization.
4.	**CS**: It is the slave’s enable.
5.	**MOSI**: from the master
6.	**Slave_start**: from the master.
8.	**CPOL, CPHA** 


### Slave Outputs:
1.	**MISO**: To the master.
2.	**Read Data**: It is a 8-bit wire array which is continuously assigned to the internal memory register to be able to trace it through the test cases.



### Slave Internals:
1.	**Memory Register**: It is the internal memory of the slave.

